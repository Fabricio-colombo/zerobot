HotkeyManager = {}

HotkeyManager.keyMapping = {
    ["enter"] = 13,
    ["space"] = 32,
    ["!"] = 33,
    ["pagedown"] = 34,
    ["#"] = 35,
    ["$"] = 36,
    ["%"] = 37,
    ["&"] = 38,
    ["'"] = 39,
    ["("] = 40,
    [")"] = 41,
    ["*"] = 42,
    ["+"] = 43,
    [","] = 44,
    ["-"] = 45,
    ["."] = 46,
    ["/"] = 47,
    ["0"] = 48,
    ["1"] = 49,
    ["2"] = 50,
    ["3"] = 51,
    ["4"] = 52,
    ["5"] = 53,
    ["6"] = 54,
    ["7"] = 55,
    ["8"] = 56,
    ["9"] = 57,
    [";"] = 59,
    ["<"] = 60,
    ["="] = 61,
    [">"] = 62,
    ["?"] = 63,
    ["@"] = 64,
    ["a"] = 65,
    ["b"] = 66,
    ["c"] = 67,
    ["d"] = 68,
    ["e"] = 69,
    ["f"] = 70,
    ["g"] = 71,
    ["h"] = 72,
    ["i"] = 73,
    ["j"] = 74,
    ["k"] = 75,
    ["l"] = 76,
    ["m"] = 77,
    ["n"] = 78,
    ["o"] = 79,
    ["p"] = 80,
    ["q"] = 81,
    ["r"] = 82,
    ["s"] = 83,
    ["t"] = 84,
    ["u"] = 85,
    ["v"] = 86,
    ["w"] = 87,
    ["x"] = 88,
    ["y"] = 89,
    ["z"] = 90,
    ["["] = 91,
    ["\\"] = 92,
    ["]"] = 93,
    ["^"] = 94,
    ["_"] = 95,
    ["`"] = 96,
    ["{"] = 123,
    ["|"] = 124,
    ["}"] = 125,
    ["~"] = 126,
    ["¢"] = 162,
    ["£"] = 163,
    ["¤"] = 164,
    ["¥"] = 165,
    ["¦"] = 166,
    ["§"] = 167,
    ["¨"] = 168,
    ["©"] = 169,
    ["ª"] = 170,
    ["«"] = 171,
    ["¬"] = 172,
    ["­"] = 173,
    ["®"] = 174,
    ["¯"] = 175,
    ["°"] = 176,
    ["±"] = 177,
    ["²"] = 178,
    ["³"] = 179,
    ["´"] = 180,
    ["µ"] = 181,
    ["¶"] = 182,
    ["·"] = 183,
    ["¸"] = 184,
    ["¹"] = 185,
    ["º"] = 186,
    ["»"] = 187,
    ["¼"] = 188,
    ["½"] = 189,
    ["¾"] = 190,
    ["¿"] = 191,
    ["×"] = 215,
    ["ß"] = 223,
    ["à"] = 224,
    ["á"] = 225,
    ["â"] = 226,
    ["ã"] = 227,
    ["ä"] = 228,
    ["å"] = 229,
    ["æ"] = 230,
    ["ç"] = 231,
    ["è"] = 232,
    ["é"] = 233,
    ["ê"] = 234,
    ["ë"] = 235,
    ["ì"] = 236,
    ["í"] = 237,
    ["î"] = 238,
    ["ï"] = 239,
    ["ð"] = 240,
    ["ñ"] = 241,
    ["ò"] = 242,
    ["ó"] = 243,
    ["ô"] = 244,
    ["õ"] = 245,
    ["ö"] = 246,
    ["÷"] = 247,
    ["ø"] = 248,
    ["ù"] = 249,
    ["ú"] = 250,
    ["û"] = 251,
    ["ü"] = 252,
    ["ý"] = 253,
    ["þ"] = 254,
    ["ÿ"] = 255,
    ["escape"] = 16777216,
    ["tab"] = 16777217,
    ["backspace"] = 16777219,
    ["insert"] = 16777222,
    ["delete"] = 16777223,
    ["pause"] = 16777224,
    ["home"] = 16777232,
    ["end"] = 16777233,
    ["left"] = 16777234,
    ["up"] = 16777235,
    ["right"] = 16777236,
    ["down"] = 16777237,
    ["pgup"] = 16777238,
    ["pgdown"] = 16777239,
    ["shift"] = 16777248,
    ["ctrl"] = 16777249,
    ["alt"] = 16777251,
    ["capslock"] = 16777252,
    ["numlock"] = 16777253,
    ["scrolllock"] = 16777254,
    ["f1"] = 16777264,
    ["f2"] = 16777265,
    ["f3"] = 16777266,
    ["f4"] = 16777267,
    ["f5"] = 16777268,
    ["f6"] = 16777269,
    ["f7"] = 16777270,
    ["f8"] = 16777271,
    ["f9"] = 16777272,
    ["f10"] = 16777273,
    ["f11"] = 16777274,
    ["f12"] = 16777275,
}

function HotkeyManager.parseKeyCombination(combination)
    local modifiers = 0
    local key = ""

    local parts = {}
    for part in string.gmatch(combination, "[^%s+]+") do
        table.insert(parts, part)
    end

    for _, part in ipairs(parts) do
        part = part:lower()
        if part == "ctrl" then
            modifiers = bit.bor(modifiers, Enums.FlagModifiers.CONTROL)
        elseif part == "alt" then
            modifiers = bit.bor(modifiers, Enums.FlagModifiers.ALT)
        elseif part == "shift" then
            modifiers = bit.bor(modifiers, Enums.FlagModifiers.SHIFT)
        elseif part == "numlock" then
            modifiers = bit.bor(modifiers, Enums.FlagModifiers.NUMLOCK)
        else
            local keyCode = HotkeyManager.keyMapping[part]
            if not keyCode then
                print("key invalid! " .. part)
                return false, nil, nil
            end
            key = keyCode -- Assume any other part is the key
        end
    end

    return true, modifiers, key
end
